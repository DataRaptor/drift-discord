# ðŸ¦¾ API

## Overview

This is an Express API to serve as the backend for linking Drift user's discord account with their Solana Wallet.

The application is deployed here: `<INSERT_LINK>`

## Configuration

This services requires a decent amount of configuration through a `.env` file.

The following are the types and descriptions for each variable.

```
PRODUCTION=[boolean string] // 'true' indicated production config
PORT=[int] // The port that this service will run on.
LOG_LEVEL=[string] // level for logs, default is 'debug'
DISCORD_API=[string] // The url to the discord api, including it's version.
DISCORD_CLIENT_ID=[string] // The Oauth client id generated by discord.
DISCORD_SECRET=[string] // The Oauth secret generated by discord.
DISCORD_REDIRECT_URI=[string] // The url to `getDiscordRedirect` route.
DISCORD_GENERATED_URL=[string] // The url generated by discord to allow users to accept authorizing our discord developer app.
CLIENT_URL=[string] // The url of the client so that the API can redirect after the user has authorized 
DRIFT_MESSAGE=[string] // The message that you would like users to sign with their wallet.
through discord.
GCP_CLOUD_SQL_INSTANCE=[string] // Cloud SQL instance name for production
MYSQL_HOST=[string] // MYSQL host
MYSQL_USERNAME=[string] //MYSQL username
MYSQL_PASSWORD=[string] //MYSQL password
MYSQL_DB=[string] // MYSQL db
AES_HTTP_TRANSPORT_SECRET=[string] // An AES secret for encrypting discord access tokens between the API and Client.
GDPR_EXEMPT_LOCALES=[string[]] // A list of GDPR exempt locales.
```

## Installation

To install node_modules run:

    yarn run install

## Development

To start the development server run:

    yarn run dev

## Build

To create a production build of the service run:

    yarn run build

To start the production build run:

    yarn run start

## Deployment

The code on the `main` branch is deployed to GCP cloud-run. Configuration files can be found in the `/gcp` directory on the top level of the repo.

## Observability

- Logs: Pino-Express
- Metrics: Prometheus. Can be found on `/metrics` route.
- Traces: Cloud platform provides traces.

## TODO

- Unit and E2E tests.
- Improve / standardize logs.
