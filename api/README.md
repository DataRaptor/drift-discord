# ðŸ¦¾ API

## Overview 

This is an Express API to serve as the backend for linking Drift user's discord account with their Solana Wallet.

The application is deployed here: `<INSERT_LINK>`

## Configuration

This services requires a decent amount of configuration through a `.env` file. 

Here is a `.env` template with *** fake *** secrets to help you get up and running.

```
PORT=8080
MONGO_CONN_STRING="mongodb+srv://<REDACTED>:<REDACTED>@cluster0.n3ulk.gcp.mongodb.net/<DB_NAME>?retryWrites=true&w=majority"
DISCORD_API="https://discord.com/api/v8"
DISCORD_CLIENT_ID="52395252623626"
DISCORD_SECRET="lFASHIJADGOIGDSKLSDG"
DISCORD_REDIRECT_URI="http://localhost:8080/v1/discord_redirect"
DISCORD_GENERATED_URL="https://discord.com/api/oauth2/authorize?client_id=997668769570750524&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Fv1%2Fdiscord_redirect&response_type=code&scope=identify%20email"
DRIFT_MESSAGE="Welcome to Drift Discord! Driftâ€™s goal is to bring a state-of-the-art trader-centric experience from centralized exchanges on-chain. We're a team of experienced traders and builders from DeFi and traditional finance working together to make this a reality."
CLIENT_URL="http://localhost:3000"
AES_HTTP_TRANSPORT_SECRET="11122233344455566677788822244455555555555555555231231321313aaaff" 
```

The following are the types and descriptions for each variable.

```
PORT=[int] // The port that this service will run on.
MONGO_CONN_STRING=[string] // A mongodb connection string.
DISCORD_API=[string] // The url to the discord api, including it's version.
DISCORD_CLIENT_ID=[string] // The Oauth client id generated by discord.
DISCORD_SECRET=[string] // The Oauth secret generated by discord.
DISCORD_REDIRECT_URI=[string] // The url to `getDiscordRedirect` route. 
DISCORD_GENERATED_URL=[string] // The url generated by discord to allow users to accept authorizing our discord developer app.
DRIFT_MESSAGE=[string] // The message that you would like users to sign with their wallet.
CLIENT_URL=[string] // The url of the client so that the API can redirect after the user has authorized through discord.
AES_HTTP_TRANSPORT_SECRET=[string] // An AES secret for encrypting discord access tokens between the API and Client.
```

## Installation

To install node_modules run:

    yarn run install

## Development

To start the development server run: 

    yarn run dev

## Build

To create a production build of the service run: 

    yarn run build

To start the production build run:

    yarn run start

## Deployment

The code on the `main` branch is deployed to GCP cloud-run. Configuration files can be found in the `/gcp` directory on the top level of the repo.

## TODO

- Unit and E2E tests.
- Improve / standardize logs. 